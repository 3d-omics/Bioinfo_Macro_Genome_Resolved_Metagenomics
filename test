#!/usr/bin/env bash
set -euo pipefail

rm -rf results reports

./run \
    --jobs 8 \
    preprocess__bowtie2 \
    preprocess__fastp \
    preprocess__kraken2 \
    preprocess__samtools \

./run \
    --jobs 8 \
    assemble__megahit

cp \
    resources/mock_assembly.fa.gz \
    results/assemble/megahit/all.fa.gz

./run \
    --jobs 8 \
    assemble__magscot \
    --rerun-triggers mtime

# mkdir --parents results/assemble/drep/separated_bins
# touch results/assemble/drep/separated_bins/.snakemake_timestamp
# gzip -dc resources/mock_assembly.fa.gz > results/assemble/drep/separated_bins/all:bin_00001.fa

mkdir --parents results/assemble/drep/separated_bins
touch results/assemble/drep/separated_bins/.snakemake_timestamp
gzip -dc resources/mock_assembly.fa.gz > results/assemble/drep/separated_bins/all:bin_00001.fa
gzip -dc resources/mock_assembly.fa.gz > results/assemble/drep/separated_bins/all:bin_00002.fa

./run \
    --jobs 8 \
    quantify \
    --rerun-triggers mtime
./run \
    --jobs 8 \
    annotate \
    --rerun-triggers mtime

./run \
    --jobs 8 \
    report \
    --rerun-triggers mtime
